{
  "rules": {
    // only admin users can read/write to the whole database. Most creation attempts will be evaluated here
    ".read": "auth !== null && data.child('users').child(auth.uid).child('admin').val() === true",
    ".write": "auth !== null && data.child('users').child(auth.uid).child('admin').val() === true",
    "canvases": {
      "$canvas": {
        // users can read all info on canvases they are assigned to
        ".read": "auth !== null && data.child('users').child(auth.uid).exists()",
        "elements": {
          "$element": {
            // users can write to elements on canvases they are assigned to
            ".write": "auth !== null && data.parent().parent().child('users').child(auth.uid).exists()"
          }
        },
        "users": {
          // users cannot modify a canvas's user list
          ".write": false
        },
        "owner": {
          // users cannot modify a canvas's owner
          ".write": false
        },
        "$canvasItem": {
          // users can write any of the other fields on the canvas if they are in the users list
          ".write": "auth !== null && data.parent().child('users').child(auth.uid).exists() && data.exists() && newData.exists()",
        }
      }
    },
    "users": {
      "$uid": {
        // users can only read their own user data
        ".read": "auth !== null && $uid === auth.uid",
        "admin": {
          // users cannot modify the admin flag on their account
          ".write": false
        },
        "canvases": {
          // users can only change the values in their canvas list
          ".write": "auth !== null && $uid === auth.uid && data.exists() && newData.exists()"
        },
        "providerData": {
          // users cannot modify the data provided by their Auth provider
          ".write": false
        },
        "$userItem": {
          // users can write any of the other fields on their user item
          ".write": "auth !== null && $uid === auth.uid && data.exists() && newData.exists()"
        }
      },
      ".indexOn":["email"]
    }
  }
}